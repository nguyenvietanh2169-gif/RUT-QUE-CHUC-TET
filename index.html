<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Quẻ Thư Pháp 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --red-silk: #a00000;
            --gold: #d4af37;
            --paper: #fdf5e6;
        }

        body {
            margin: 0;
            background: #222 url('https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/IMG_6492.JPG?raw=true') no-repeat center center fixed;
            background-size: cover;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6);
        }

        /* Ống quẻ */
        #container {
            position: relative;
            z-index: 10;
            width: 200px;
            height: 350px;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .cup-layer { position: absolute; width: 100%; bottom: 0; pointer-events: none; }
        #sticks { z-index: 2; bottom: 80px; width: 65%; transition: transform 0.1s; }
        #cup-front { z-index: 3; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }

        /* Hiệu ứng lắc */
        .shaking { animation: shake 0.1s infinite alternate; }
        @keyframes shake {
            from { transform: rotate(5deg) translateY(0); }
            to { transform: rotate(-5deg) translateY(-10px); }
        }

        /* Cây quẻ bay */
        #flying-stick {
            position: fixed;
            width: 50px;
            z-index: 50;
            display: none;
            left: 50%;
            bottom: 200px;
            transform: translateX(-50%);
        }

        /* Cuộn giấy thư pháp */
        #scroll-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .scroll-wrapper {
            position: relative;
            width: 60px; /* Ban đầu thu nhỏ như cây quẻ */
            height: 70vh;
            max-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .scroll-wrapper.open {
            width: 90vw;
            max-width: 450px;
        }

        .scroll-content {
            width: 100%;
            height: 90%;
            background: var(--paper);
            border: 2px solid var(--red-silk);
            outline: 5px double var(--red-silk);
            outline-offset: -12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .roller {
            position: absolute;
            width: 25px;
            height: 105%;
            background: linear-gradient(to right, #3e2723, #5d4037, #3e2723);
            border-radius: 4px;
            z-index: 2;
        }

        .roller.left { left: 0; transform: translateX(-50%); }
        .roller.right { right: 0; transform: translateX(50%); }

        .wish-text {
            font-family: 'Dancing Script', cursive;
            color: var(--red-silk);
            font-size: 2rem;
            text-align: center;
            white-space: pre-line;
            opacity: 0;
            transition: opacity 0.8s 0.8s;
        }

        .open .wish-text { opacity: 1; }

        /* Nút */
        .btn-start {
            position: absolute;
            bottom: 50px;
            padding: 15px 40px;
            background: var(--red-silk);
            color: var(--gold);
            border: 2px solid var(--gold);
            font-weight: bold;
            cursor: pointer;
            z-index: 20;
            border-radius: 50px;
        }
    </style>
</head>
<body>

    <div id="container" onclick="startGieoQue()">
        <img id="cup-back" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true" style="filter: brightness(0.5)">
        <img id="sticks" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true">
        <img id="cup-front" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true">
    </div>

    <img id="flying-stick" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true">

    <div id="scroll-overlay" onclick="closeScroll()">
        <div class="scroll-wrapper" id="scrollWrapper">
            <div class="roller left"></div>
            <div class="scroll-content">
                <div class="wish-text" id="wishDisplay"></div>
            </div>
            <div class="roller right"></div>
        </div>
    </div>

    <button class="btn-start" id="btnStart">CHẠM ĐỂ GIEO QUẺ</button>

    <audio id="sfx" src="https://www.soundjay.com/misc/sounds/wooden-clatter-1.mp3"></audio>

    <script>
        const wishes = [
            "Mã Đáo Thành Công\nVạn Sự Hanh Thông",
            "Tiền Vô Như Nước\nPhúc Lộc Đầy Nhà",
            "An Khang Thịnh Vượng\nSức Khỏe Dồi Dào",
            "Tình Duyên Viên Mãn\nHạnh Phúc Vững Bền",
            "Công Thành Danh Toại\nSự Nghiệp Thăng Hoa",
            "Ngũ Phúc Lâm Môn\nPhú Quý Cát Tường",
            "Vạn Sự Như Ý\nĐắc Lộc Toàn Gia",
            "Thân Tâm An Lạc\nTrí Tuệ Minh Mẫn"
        ];

        let canShake = true;
        const container = document.getElementById('container');
        const flyingStick = document.getElementById('flying-stick');
        const scrollOverlay = document.getElementById('scroll-overlay');
        const scrollWrapper = document.getElementById('scrollWrapper');
        const wishDisplay = document.getElementById('wishDisplay');
        const sfx = document.getElementById('sfx');

        function startGieoQue() {
            if (!canShake) return;
            canShake = false;
            document.getElementById('btnStart').style.display = 'none';

            // Bắt đầu lắc
            sfx.play();
            container.classList.add('shaking');

            setTimeout(() => {
                container.classList.remove('shaking');
                animateStick();
            }, 1200);
        }

        function animateStick() {
            flyingStick.style.display = 'block';
            
            // Cây quẻ bay vọt lên trung tâm màn hình
            const fly = flyingStick.animate([
                { bottom: '200px', transform: 'translateX(-50%) rotate(0deg)', opacity: 1 },
                { bottom: '50%', transform: 'translateX(-50%) translateY(50%) rotate(720deg) scale(2)', opacity: 1 }
            ], {
                duration: 1000,
                easing: 'ease-out',
                fill: 'forwards'
            });

            fly.onfinish = () => {
                setTimeout(() => {
                    flyingStick.style.display = 'none';
                    openScroll();
                }, 200);
            };
        }

        function openScroll() {
            const randomWish = wishes[Math.floor(Math.random() * wishes.length)];
            wishDisplay.innerText = randomWish + "\nBính Ngọ 2026";
            
            scrollOverlay.style.display = 'flex';
            setTimeout(() => {
                scrollWrapper.classList.add('open');
            }, 50);
        }

        function closeScroll() {
            scrollWrapper.classList.remove('open');
            setTimeout(() => {
                scrollOverlay.style.display = 'none';
                canShake = true;
                document.getElementById('btnStart').style.display = 'block';
            }, 800);
        }

        // Xin quyền cảm biến cho iOS
        document.getElementById('btnStart').onclick = (e) => {
            e.stopPropagation();
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(res => {
                    if(res === 'granted') startGieoQue();
                });
            } else {
                startGieoQue();
            }
        };
    </script>
</body>
</html>
