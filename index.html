<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Quẻ Bính Ngọ 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Charm:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --red-ancient: #8b0000;
        }

        body {
            margin: 0;
            background: #111 url('https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/IMG_6492.JPG?raw=true') no-repeat center center fixed;
            background-size: cover;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Segoe UI', serif;
        }

        body::before {
            content: "";
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        #container {
            position: relative;
            width: 320px;
            height: 480px;
            z-index: 10;
            cursor: pointer;
            display: flex;
            justify-content: center;
        }

        .cup-layer { position: absolute; bottom: 0; width: 100%; pointer-events: none; }
        #cup-back { z-index: 1; filter: brightness(0.3); }
        #cup-front { z-index: 5; filter: drop-shadow(0 15px 40px rgba(0,0,0,0.8)); }

        .sticks-bundle {
            position: absolute;
            bottom: 225px; 
            left: 38%; 
            transform: translateX(-50%);
            width: 66px; height: 200px;
            z-index: 3;
            display: flex;
            justify-content: center;
        }

        .stick-item {
            position: absolute;
            width: 95px; 
            filter: brightness(0.85) contrast(1.1);
            bottom: 0;
            transform-origin: bottom center;
        }

        /* LẮC NGẪU NHIÊN */
        .shaking .stick-item { animation: messy-shake 0.4s infinite alternate; }
        @keyframes messy-shake {
            0% { transform: translateX(-3px) rotate(calc(var(--r) - 1.5deg)); }
            50% { transform: translateX(3px) rotate(calc(var(--r) + 2deg)); }
            100% { transform: translateX(-2px) rotate(calc(var(--r) - 1deg)); }
        }

        .shaking-cup { animation: cup-vibrate 0.1s infinite alternate; }
        @keyframes cup-vibrate { from { transform: rotate(-2deg); } to { transform: rotate(2deg); } }

        /* LIỄN ĐỎ - TỐI ƯU CHỐNG LAG */
        #scroll-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .lien-wrapper {
            position: relative;
            width: 85vw;
            max-width: 450px;
            height: 80vh;
            transform: scaleY(0); /* Dùng scale thay cho height để chống lag */
            transform-origin: top;
            transition: transform 1s cubic-bezier(0.23, 1, 0.32, 1);
            will-change: transform;
        }

        .lien-wrapper.open { transform: scaleY(1); }

        .lien-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/background%20loi%20chuc%20(1).png?raw=true') no-repeat center top;
            background-size: 100% 100%;
            z-index: 1;
        }

        .wish-text {
            position: relative;
            z-index: 2;
            font-family: 'Charm', cursive;
            font-weight: 700;
            background: linear-gradient(to bottom, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.2rem;
            text-align: center;
            white-space: pre-line;
            opacity: 0;
            padding-top: 220px; /* Điều chỉnh để khớp ảnh nền mới */
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.4));
            transition: opacity 0.5s 0.8s;
        }
        .open .wish-text { opacity: 1; }

        .btn-ui {
            position: relative; z-index: 20;
            margin-top: 30px; padding: 15px 40px;
            background: var(--red-ancient); color: var(--gold);
            border: 2px solid var(--gold); font-weight: bold;
            cursor: pointer; letter-spacing: 2px;
            border-radius: 5px; text-transform: uppercase;
        }

        #fireworks-canvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; pointer-events: none;
            z-index: 105;
        }
    </style>
</head>
<body>

    <audio id="bgMusic" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/raw/refs/heads/main/nhac%20tet.mp3" loop preload="auto"></audio>
    <audio id="lacQueSound" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/raw/refs/heads/main/%C4%90u%CC%9Bo%CC%9B%CC%80ng%20An%20Chu%208_Audio%20Denoise%20(mp3cut.net).mp3" preload="auto"></audio>

    <div id="container" onclick="requestPermission()">
        <img id="cup-back" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true">
        <div class="sticks-bundle">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: -8deg; left: 0%;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: -4deg; left: 15%;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: 0deg; left: 30%;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: 4deg; left: 45%;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: 8deg; left: 60%;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: -2deg; left: 20%; z-index: 4;">
            <img class="stick-item" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="--r: 2deg; left: 40%; z-index: 4;">
        </div>
        <img id="cup-front" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true">
    </div>

    <button class="btn-ui" id="btnAction" onclick="requestPermission()">Tâm Thành Ý Nguyện</button>

    <div id="scroll-overlay" onclick="closeScroll()">
        <canvas id="fireworks-canvas"></canvas>
        <div class="lien-wrapper" id="lienWrapper">
            <div class="lien-bg"></div>
            <div class="wish-text" id="wishDisplay"></div>
        </div>
    </div>

    <script>
        const wishes = [
            "Ăn nhiều không béo\nNợ nần tự héo\nVí tiền dẻo dai",
            "Da đẹp như tiên\nTiền đầy như biển\nVạn sự bình yên\nKhông có gì phiền",
            "Da đẹp như tiên\nTiền đầy như biển\nVạn sự bình yên",
            "Ăn ngon không mập\nNgủ kỹ không muộn\nMuộn phiền tự tan",
            "Cuộc sống nở hoa\nDrama không có\nVí tiền tự to",
            "Tâm an thân khỏe\nChẳng chút ưu phiền\nSống vui sống khoẻ\n Như tiên trên đời",
            "Vàng ròng đầy tủ\nKim cương đầy khay\nLàm chơi ăn thật\nTiền về đầy tay",
            "Đầu tư là trúng\nBốc quẻ là giàu\nTiền tiêu không hết\nĐau đầu chọn xe",
            "Thần Tài gõ cửa\nPhú quý vây quanh\nCát tường như ý\nTài lộc tươi xanh",
            "Vạn sự như ý\nTỷ sự như mơ\nTriệu điều bất ngờ\n Không chờ cũng đến",
            "Sức khỏe dẻo dai\nPhong độ bất bại\nĂn ngon ngủ kĩ\nTinh thần thảnh thơi",
            "Tâm an thân khỏe\nChẳng chút ưu phiền\nVui vẻ như tiên",
            "Vàng ròng đầy tủ\nKim cương đầy khay\nLộc về đầy tay",
            "Đầu tư là trúng\nBốc quẻ là giàu\nTiền tiêu không hết",
            "Thần Tài gõ cửa\nPhú quý vây quanh\nTài lộc tươi xanh",
            "Vạn sự như ý\nTỷ sự như mơ\nTriệu điều bất ngờ",
            "Sức khỏe dẻo dai\nPhong độ bất bại\nTinh thần xanh tươi"
        ];

        let active = false;
        let lastUpdate = 0;
        let x=0, y=0, z=0, lastX=0, lastY=0, lastZ=0;
        const SHAKE_LIMIT = 15;

        const canvas = document.getElementById('fireworks-canvas');
        const ctx = canvas.getContext('2d');
        let fireworks = [];
        let particles = [];

        function requestPermission() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(res => {
                    if (res == 'granted') window.addEventListener('devicemotion', handleMotion);
                });
            } else {
                window.addEventListener('devicemotion', handleMotion);
            }
            startGieo();
        }

        function handleMotion(e) {
            if (active) return;
            let acc = e.accelerationIncludingGravity;
            let now = Date.now();
            if ((now - lastUpdate) > 100) {
                let diff = now - lastUpdate;
                lastUpdate = now;
                x = acc.x; y = acc.y; z = acc.z;
                let speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diff * 10000;
                if (speed > SHAKE_LIMIT * 100) startGieo();
                lastX = x; lastY = y; lastZ = z;
            }
        }

        function startGieo() {
            if (active) return;
            active = true;
            document.getElementById('btnAction').style.visibility = 'hidden';
            document.getElementById('lacQueSound').play().catch(()=>{});
            document.getElementById('container').classList.add('shaking', 'shaking-cup');
            
            setTimeout(() => {
                document.getElementById('container').classList.remove('shaking', 'shaking-cup');
                openScroll();
            }, 1800);
        }

        function openScroll() {
            document.getElementById('bgMusic').play().catch(()=>{});
            document.getElementById('wishDisplay').innerText = wishes[Math.floor(Math.random() * wishes.length)];
            document.getElementById('scroll-overlay').style.display = 'flex';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            setTimeout(() => {
                document.getElementById('lienWrapper').classList.add('open');
                render();
            }, 50);
        }

        function closeScroll() {
            document.getElementById('bgMusic').pause();
            document.getElementById('lienWrapper').classList.remove('open');
            setTimeout(() => {
                document.getElementById('scroll-overlay').style.display = 'none';
                document.getElementById('btnAction').style.visibility = 'visible';
                active = false;
                fireworks = []; particles = [];
            }, 600);
        }

        // PHÁO HOA TỐI ƯU
        class Firework {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.targetY = Math.random() * (canvas.height * 0.4);
                this.speed = 7;
                this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
            }
            draw() {
                this.y -= this.speed;
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, 7); ctx.fill();
                if (this.y <= this.targetY) {
                    for (let i = 0; i < 25; i++) particles.push(new Particle(this.x, this.y, this.color));
                    return false;
                }
                return true;
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.angle = Math.random() * 6.28;
                this.v = Math.random() * 4 + 2;
                this.alpha = 1;
            }
            draw() {
                this.v *= 0.96;
                this.x += Math.cos(this.angle) * this.v;
                this.y += Math.sin(this.angle) * this.v + 0.1;
                this.alpha -= 0.02;
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, 1.5, 0, 7); ctx.fill();
                return this.alpha > 0;
            }
        }

        function render() {
            if (!active) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (Math.random() < 0.05) fireworks.push(new Firework());
            fireworks = fireworks.filter(f => f.draw());
            particles = particles.filter(p => p.draw());
            ctx.globalAlpha = 1;
            requestAnimationFrame(render);
        }
    </script>
</body>
</html>
