<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Quẻ Bính Ngọ 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --silk: #4e342e;
            --paper: #f2e8cf;
            --ink: #1a1a1a;
            --gold: #d4af37;
            --red-ancient: #8b0000;
        }

        body {
            margin: 0;
            background: #111 url('https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/IMG_6492.JPG?raw=true') no-repeat center center fixed;
            background-size: cover;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Segoe UI', serif;
        }

        /* Lớp phủ tối nhẹ nhưng không làm mờ ảnh nền */
        body::before {
            content: "";
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 0;
        }

        /* ỐNG QUẺ TRUNG TÂM */
        #container {
            position: relative;
            width: 280px;
            height: 450px;
            z-index: 10;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-top: -20px;
        }

        .cup-layer { position: absolute; bottom: 0; width: 100%; pointer-events: none; }
        #cup-back { z-index: 1; filter: brightness(0.5); }
        #cup-front { z-index: 5; filter: drop-shadow(0 15px 40px rgba(0,0,0,0.8)); }

        /* CÂY QUẺ NỔI TRÊN MIỆNG ỐNG */
        .stick-group {
            position: absolute;
            bottom: 210px; /* Nâng cao lên để lộ đầu quẻ */
            width: 14%;
            z-index: 3;
            filter: brightness(0.8);
            transition: transform 0.1s;
        }

        /* Animation lắc quẻ nảy cao */
        .shaking .s1 { animation: shake-s 0.1s infinite alternate; }
        .shaking .s2 { animation: shake-s 0.08s infinite alternate-reverse; }
        .shaking .s3 { animation: shake-s 0.12s infinite alternate; animation-delay: 0.04s; }

        @keyframes shake-s {
            0% { transform: translateY(0) rotate(-2deg); }
            100% { transform: translateY(-90px) rotate(4deg); }
        }

        .shaking-cup { animation: shake-c 0.1s infinite alternate; }
        @keyframes shake-c {
            from { transform: rotate(-4deg); }
            to { transform: rotate(4deg); }
        }

        /* QUẺ BAY VÀ CUỘN GIẤY */
        #flying-stick {
            position: fixed;
            width: 40px;
            z-index: 60;
            display: none;
            left: 50%;
            top: 40%;
            transform: translateX(-50%);
        }

        #scroll-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .scroll-wrapper {
            position: relative;
            width: 40px;
            height: 75vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 1.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .scroll-wrapper.open {
            width: 90vw;
            max-width: 480px;
        }

        .scroll-content {
            width: 100%;
            height: 95%;
            background: var(--paper);
            background-image: 
                url('https://www.transparenttextures.com/patterns/handmade-paper.png'),
                radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(210,180,140,0.2) 100%);
            border: 10px solid var(--silk);
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .scroll-content::after {
            content: "";
            position: absolute;
            top: 8px; left: 8px; right: 8px; bottom: 8px;
            border: 2px solid var(--red-ancient);
            outline: 3px double var(--red-ancient);
            outline-offset: -10px;
        }

        .roller {
            position: absolute;
            width: 30px;
            height: 105%;
            background: linear-gradient(to right, #2b1d1a, #5d4037, #2b1d1a);
            border-radius: 4px;
            z-index: 10;
        }
        .roller.left { left: -5px; transform: translateX(-50%); }
        .roller.right { right: -5px; transform: translateX(50%); }

        .wish-text {
            font-family: 'Dancing Script', cursive;
            color: var(--ink);
            font-size: 2.1rem;
            text-align: center;
            white-space: pre-line;
            opacity: 0;
            z-index: 5;
            transition: opacity 0.8s 1s;
        }

        .open .wish-text { opacity: 1; }

        .btn-ui {
            position: relative;
            z-index: 20;
            margin-top: 40px;
            padding: 15px 45px;
            background: var(--red-ancient);
            color: var(--gold);
            border: 2px solid var(--gold);
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div id="container" onclick="startGieo()">
        <img id="cup-back" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true">
        
        <img class="stick-group s1" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="left: 36%; transform: rotate(-5deg);">
        <img class="stick-group s2" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="left: 43%; transform: rotate(2deg);">
        <img class="stick-group s3" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true" style="left: 50%; transform: rotate(7deg);">
        
        <img id="cup-front" class="cup-layer" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/ong%20que.png?raw=true">
    </div>

    <img id="flying-stick" src="https://github.com/nguyenvietanh2169-gif/RUT-QUE-CHUC-TET/blob/main/que.png?raw=true">

    <button class="btn-ui" id="btnAction">TÂM THÀNH Ý NGUYỆN</button>

    <div id="scroll-overlay" onclick="closeScroll()">
        <div class="scroll-wrapper" id="scrollWrapper">
            <div class="roller left"></div>
            <div class="scroll-content">
                <div class="wish-text" id="wishDisplay"></div>
            </div>
            <div class="roller right"></div>
        </div>
    </div>

    <audio id="sfx" src="https://www.soundjay.com/misc/sounds/wooden-clatter-1.mp3"></audio>

    <script>
        const wishes = [
            "Mã Đáo Thành Công\nVạn Sự Hanh Thông", "Thiên Ý Cát Tường\nPhú Quý Bình An",
            "Ngũ Phúc Lâm Môn\nĐắc Lộc Toàn Gia", "Công Thành Danh Toại\nSự Nghiệp Thăng Hoa",
            "An Khang Thịnh Vượng\nSức Khỏe Dồi Dào", "Vạn Kỳ Như Ý\nTấn Tài Tấn Lộc",
            "Thân Tâm An Lạc\nTrí Tuệ Minh Mẫn", "Gia Hòa Vạn Sự Hưng\nHạnh Phúc Bền Lâu",
            "Khai Xuân Đại Cát\nThuận Buồm Xuôi Gió", "Phong Thủy Hữu Tình\nTài Lộc Vô Biên",
            "Nhất Phẩm Đương Triều\nDanh Tiếng Vang Xa", "Kim Ngọc Mãn Đường\nPhúc Thọ Song Toàn",
            "Bách Nghiệp Hưng Thịnh\nThời Lai Vận Đáo", "Cung Hỷ Phát Tài\nXuân Phong Đắc Ý",
            "Đức Tài Song Lập\nPhúc Trạch Vĩnh Miên", "Tình Duyên Viên Mãn\nSong Hỷ Lâm Môn",
            "Học Vấn Tinh Thông\nBảng Vàng Đề Tên", "Tiền Trình Tự Cẩm\nRạng Rỡ Tổ Tông",
            "Phúc Tinh Cao Chiếu\nSự Nghiệp Vững Bền", "Vạn Cổ Trường Xuân\nPhú Quý Cát Tường"
        ];

        let active = false;
        const sfx = document.getElementById('sfx');

        function startGieo() {
            if (active) return;
            active = true;
            document.getElementById('btnAction').style.visibility = 'hidden';

            sfx.play().catch(()=>{});
            const container = document.getElementById('container');
            container.classList.add('shaking', 'shaking-cup');

            setTimeout(() => {
                container.classList.remove('shaking', 'shaking-cup');
                launchStick();
            }, 1400);
        }

        function launchStick() {
            const fs = document.getElementById('flying-stick');
            fs.style.display = 'block';
            fs.animate([
                { top: '45%', opacity: 1, transform: 'translateX(-50%) scale(1)' },
                { top: '20%', opacity: 0, transform: 'translateX(-50%) scale(3) rotate(720deg)' }
            ], { duration: 1100, easing: 'ease-in-out' }).onfinish = () => {
                fs.style.display = 'none';
                openScroll();
            };
        }

        function openScroll() {
            const random = wishes[Math.floor(Math.random() * wishes.length)];
            document.getElementById('wishDisplay').innerText = random + "\nBính Ngọ 2026";
            document.getElementById('scroll-overlay').style.display = 'flex';
            setTimeout(() => document.getElementById('scrollWrapper').classList.add('open'), 50);
        }

        function closeScroll() {
            document.getElementById('scrollWrapper').classList.remove('open');
            setTimeout(() => {
                document.getElementById('scroll-overlay').style.display = 'none';
                document.getElementById('btnAction').style.visibility = 'visible';
                active = false;
            }, 800);
        }

        // CHỨC NĂNG LẮC (Shake Functionality)
        function initShake() {
            let lastX, lastY, lastZ;
            let moveCounter = 0;

            window.addEventListener('devicemotion', function(event) {
                let acceleration = event.accelerationIncludingGravity;
                if (!acceleration || active) return;

                let curX = acceleration.x;
                let curY = acceleration.y;
                let curZ = acceleration.z;

                if (lastX !== undefined) {
                    let diffX = Math.abs(lastX - curX);
                    let diffY = Math.abs(lastY - curY);
                    let diffZ = Math.abs(lastZ - curZ);

                    // Ngưỡng lắc (Threshold) - điều chỉnh số 15 nếu muốn nhạy hơn
                    if ((diffX > 15 && diffY > 15) || (diffX > 15 && diffZ > 15) || (diffY > 15 && diffZ > 15)) {
                        moveCounter++;
                        if (moveCounter > 2) {
                            startGieo();
                            moveCounter = 0;
                        }
                    }
                }
                lastX = curX; lastY = curY; lastZ = curZ;
            });
        }

        document.getElementById('btnAction').onclick = (e) => {
            e.stopPropagation();
            // Yêu cầu quyền cảm biến cho iOS
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') initShake();
                        startGieo();
                    });
            } else {
                initShake();
                startGieo();
            }
        };
    </script>
</body>
</html>
